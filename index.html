<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>10秒で止めてみよう！</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" type="image/png" href="DBD913EE-2355-4DCB-B6A6-5A975BD4ECEE.png">
  <link rel="apple-touch-icon" href="DBD913EE-2355-4DCB-B6A6-5A975BD4ECEE.png">
  <meta name="theme-color" content="#000000">

  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      background: #000;
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    #app {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .timer-wrapper {
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .title {
      color: #888;
      margin-bottom: 0.3rem;
      font-size: 1.2rem;
      letter-spacing: 0.1em;
    }

    .subtitle {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 1.2rem;
      letter-spacing: 0.05em;
      text-align: center;
    }

    .time-display {
      font-size: min(20vw, 120px);
      font-family: "SF Mono", ui-monospace, Menlo, Consolas, "Roboto Mono", monospace;
      display: inline-block;
      min-width: 6ch;
      text-align: center;
      transition: opacity 0.2s ease, color 0.2s ease, font-weight 0.2s ease, text-shadow 0.2s ease;
      opacity: 1;
    }

    .control-button {
      margin-top: 1cm;
      width: min(18vw, 90px);
      height: min(18vw, 90px);
      border-radius: 50%;
      border: none;
      cursor: pointer;
      font-size: min(4vw, 18px);
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 12px rgba(0, 0, 0, 0.6);
      transition: transform 0.1s ease, box-shadow 0.1s ease;
    }

    .control-button:active {
      transform: scale(0.96);
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.8);
    }

    .state-start {
      background: #004400;
      color: #66ff66;
    }

    .state-stop {
      background: #550000;
      color: #ff6666;
    }

    .state-reset {
      background: #666;
      color: #ddd;
    }

    .time-near {
      color: orange;
      font-weight: 800;
      text-shadow: 0 0 10px rgba(255,165,0,0.8);
    }

    .time-perfect {
      color: #ffff33;
      font-weight: 900;
      text-shadow: 0 0 14px rgba(255,255,0,0.9);
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="timer-wrapper">
      <div class="title">10秒で止めてみよう！</div>
      <div class="subtitle">ばーじょんA</div>
      <div id="time" class="time-display">00:00</div>
      <button id="controlButton" class="control-button state-start">スタート</button>
    </div>
  </div>

  <script>
    (function () {
      let state = "idle";
      let startTime = null;
      let timerId = null;

      const timeEl = document.getElementById("time");
      const btn = document.getElementById("controlButton");

      function getNow() {
        return (typeof performance !== "undefined" && performance.now)
          ? performance.now()
          : Date.now();
      }

      function formatTime(elapsedMs) {
        const totalCentis = Math.floor(elapsedMs / 10);
        const seconds = Math.floor(totalCentis / 100);
        const centis = totalCentis % 100;
        return String(seconds).padStart(2, "0") + ":" + String(centis).padStart(2, "0");
      }

      function updateDisplay() {
        if (state !== "running" || startTime === null) return;

        const now = getNow();
        const elapsedMs = now - startTime;
        const elapsedSec = elapsedMs / 1000;

        timeEl.textContent = formatTime(elapsedMs);

        if (elapsedSec > 5) {
          const t = Math.min((elapsedSec - 5) / 1.5, 1);
          timeEl.style.opacity = (1 - t).toFixed(2);
        } else {
          timeEl.style.opacity = "1";
        }
      }

      function clearTimer() {
        if (timerId !== null) {
          clearInterval(timerId);
          timerId = null;
        }
      }

      function resetHighlight() {
        timeEl.classList.remove("time-near", "time-perfect");
        timeEl.style.opacity = "1";
      }

      function setButtonAppearance(mode) {
        btn.classList.remove("state-start", "state-stop", "state-reset");
        if (mode === "idle") {
          btn.textContent = "スタート";
          btn.classList.add("state-start");
        } else if (mode === "running") {
          btn.textContent = "ストップ";
          btn.classList.add("state-stop");
        } else {
          btn.textContent = "リセット";
          btn.classList.add("state-reset");
        }
      }

      function finalizeStop(elapsedMs) {
        const totalCentis = Math.floor(elapsedMs / 10);
        const seconds = Math.floor(totalCentis / 100);
        const centis = totalCentis % 100;
        timeEl.textContent = String(seconds).padStart(2, "0") + ":" + String(centis).padStart(2, "0");
        timeEl.style.opacity = "1";

        resetHighlight();

        if (totalCentis === 1000) {
          timeEl.classList.add("time-perfect");
        } else if (
          (totalCentis >= 985 && totalCentis <= 999) ||
          (totalCentis >= 1001 && totalCentis <= 1015)
        ) {
          timeEl.classList.add("time-near");
        }
      }

      btn.addEventListener("click", () => {
        if (state === "idle") {
          resetHighlight();
          state = "running";
          setButtonAppearance("running");
          timeEl.textContent = "00:00";
          timeEl.style.opacity = "1";
          startTime = getNow();
          timerId = setInterval(updateDisplay, 10);

        } else if (state === "running") {
          clearTimer();
          finalizeStop(getNow() - startTime);
          state = "stopped";
          setButtonAppearance("stopped");

        } else {
          clearTimer();
          state = "idle";
          setButtonAppearance("idle");
          timeEl.textContent = "00:00";
          resetHighlight();
          startTime = null;
        }
      });

      setButtonAppearance("idle");
    })();
  </script>
</body>
</html>
